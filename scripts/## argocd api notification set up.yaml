## argocd api notification set up

export app=node

kubectl patch app $app -n argocd -p '{"metadata": {"annotations": {"notifications.argoproj.io/subscribe.on-sync-succeeded.slack":"orakl-notification"}}}' --type merge

kubectl patch app $app -n argocd -p '{"metadata": {"annotations": {"notifications.argoproj.io/subscribe.on-sync-status-unknown.slack":"orakl-notification"}}}' --type merge

kubectl patch app $app -n argocd -p '{"metadata": {"annotations": {"notifications.argoproj.io/subscribe.on-sync-failed":"orakl-notification"}}}' --type merge

kubectl patch app $app -n argocd -p '{"metadata": {"annotations": {"notifications.argoproj.io/subscribe.on-sync-running":"orakl-notification"}}}' --type merge

kubectl patch app $app -n argocd -p '{"metadata": {"annotations": {"notifications.argoproj.io/subscribe.on-health-degraded":"orakl-notification"}}}' --type merge



## patch template
kubectl patch configmap argocd-notifications-cm -n argocd --type merge -p '{"data": {"service.slack": "token: $slack-token"}}'

## cypress notification template ##

#sync sccess

  message: |
    {{if eq .serviceType "slack"}}:white_check_mark:{{end}} *cypress* `{{.app.metadata.name}}` has been successfully synced.
  slack:
    attachments: "[{\n  \"title\": \"{{ .app.metadata.name}}\",\n  \"title_link\":\"http://cypress.argocd.orakl.network/applications/{{.app.metadata.name}}\",\n  \"color\": \"#18be52\",\n  \"fields\": [\n  {\n    \"title\": \"Sync Status\",\n    \"value\": \"{{.app.status.sync.status}}\",\n    \"short\": true\n  },\n  {\n    \"title\": \"Repository\",\n    \"value\": \"https://github.com/Bisonai/orakl-helm-charts/tree/idc-fly/{{.app.metadata.name}}\",\n    \"short\": true\n  }\n  {{range $index, $c := .app.status.conditions}}\n  {{if not $index}},{{end}}\n  {{if $index}},{{end}}\n  {\n    \"title\": \"{{$c.type}}\",\n    \"value\": \"{{$c.message}}\",\n    \"short\": true\n  }\n  {{end}}\n  ]\n}]"


#sync started

message: |
  The sync operation of *cypress* `{{.app.metadata.name}}` has started.
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://cypress.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#0DADEA",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]


#sync unknown

message: |
  {{if eq .serviceType "slack"}}:exclamation:{{end}} *cypress* `{{.app.metadata.name}}` sync is 'Unknown'.
  {{if ne .serviceType "slack"}}
  {{range $c := .app.status.conditions}}
      * {{$c.message}}
  {{end}}
  {{end}}
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://cypress.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#E96D76",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]


#sync failed

message: |
  {{if eq .serviceType "slack"}}:exclamation:{{end}}  The sync operation of *cypress* `{{.app.metadata.name}}` has failed with the following error: {{.app.status.operationState.message}}
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://cypress.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#E96D76",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      },
      {
        "title": "Repository",
        "value": "https://github.com/Bisonai/orakl-helm-charts/tree/idc-fly/{{.app.metadata.name}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]



-------------
Baobab Template


## cypress notification template ##

#sync sccess

  message: |
    {{if eq .serviceType "slack"}}:white_check_mark:{{end}} *baobab* `{{.app.metadata.name}}` has been successfully synced.
  slack:
    attachments: "[{\n  \"title\": \"{{ .app.metadata.name}}\",\n  \"title_link\":\"http://baobab.argocd.orakl.network/applications/{{.app.metadata.name}}\",\n  \"color\": \"#18be52\",\n  \"fields\": [\n  {\n    \"title\": \"Sync Status\",\n    \"value\": \"{{.app.status.sync.status}}\",\n    \"short\": true\n  },\n  {\n    \"title\": \"Repository\",\n    \"value\": \"https://github.com/Bisonai/orakl-helm-charts/tree/idc-fly/{{.app.metadata.name}}\",\n    \"short\": true\n  }\n  {{range $index, $c := .app.status.conditions}}\n  {{if not $index}},{{end}}\n  {{if $index}},{{end}}\n  {\n    \"title\": \"{{$c.type}}\",\n    \"value\": \"{{$c.message}}\",\n    \"short\": true\n  }\n  {{end}}\n  ]\n}]"


#sync started

message: |
  The sync operation of *baobab* `{{.app.metadata.name}}` has started.
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://baobab.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#0DADEA",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]


#sync unknown

message: |
  {{if eq .serviceType "slack"}}:exclamation:{{end}} *baobab* `{{.app.metadata.name}}` sync is 'Unknown'.
  {{if ne .serviceType "slack"}}
  {{range $c := .app.status.conditions}}
      * {{$c.message}}
  {{end}}
  {{end}}
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://baobab.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#E96D76",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]


#sync failed

message: |
  {{if eq .serviceType "slack"}}:exclamation:{{end}}  The sync operation of *baobab* `{{.app.metadata.name}}` has failed with the following error: {{.app.status.operationState.message}}
slack:
  attachments: |-
    [{
      "title": "{{ .app.metadata.name}}",
      "title_link":"http://baobab.argocd.orakl.network/applications/{{.app.metadata.name}}",
      "color": "#E96D76",
      "fields": [
      {
        "title": "Sync Status",
        "value": "{{.app.status.sync.status}}",
        "short": true
      },
      {
        "title": "Repository",
        "value": "https://github.com/Bisonai/orakl-helm-charts/tree/idc-fly/{{.app.metadata.name}}",
        "short": true
      }
      {{range $index, $c := .app.status.conditions}}
      {{if not $index}},{{end}}
      {{if $index}},{{end}}
      {
        "title": "{{$c.type}}",
        "value": "{{$c.message}}",
        "short": true
      }
      {{end}}
      ]
    }]